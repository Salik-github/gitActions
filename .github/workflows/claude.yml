name: ðŸ“ Free Gemini CLI File Processor

on:
  workflow_dispatch: 
  push:
jobs:
  process_markdown:
    runs-on: ubuntu-latest
    
    steps:
      - name: 1. Checkout Code
        uses: actions/checkout@v4

      - name: 2. Setup Node.js (Required for CLI)
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: 3. Install Open-Source Gemini CLI
        run: npm install -g @google/gemini-cli

      - name: 4. Execute E2E Testing Agent with MD Context (FIXED)
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          echo "Starting E2E Testing Agent using project/prompt.md for instructions..."
          
          # ----------------------------------------------------------------------------------
          # NOTE: To use a Playwright MCP server, you must set up the config:
          # This requires creating a .gemini/settings.json file in the repo root 
          # with the Playwright MCP server configured, OR running a service in Docker.
          # For a basic test generation without external servers, this is a good start.
          # ----------------------------------------------------------------------------------

          # The @ symbol includes the full content of the file (project/prompt.md)
          # The agent's instructions (your rules and steps) are now inside that file.
          
          gemini \
            "As an E2E Testing Agent, analyze the instructions in the attached Markdown file. When the context indicates the step 'run', execute the Playwright test generation and execution steps exactly as described in the file. @project/prompt.md" \
            --model gemini-2.5-flash \
            --output-format text > AGENT_OUTPUT.md
          
          echo "--- Agent Response and Action Log ---"
          cat AGENT_OUTPUT.md

     