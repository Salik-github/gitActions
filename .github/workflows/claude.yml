name: E2E Tests with Nay Agent

on:
  workflow_dispatch:                 # Manual run from UI
  push:                            # Trigger on push

jobs:
  use-playwright:
  
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Nay (free AI agent CLI)
        run: curl -fsSL https://nay.dev/install.sh | bash

      - name: Install Playwright + Node
        run: |
          nay --version
          npm init -y
          npm install playwright @playwright/test
          npx playwright install --with-deps

      - name: Create required files/folders
        run: |
          mkdir -p screenshots playwright-report

      - name: Run Nay Agent with your prompt.md
        run: |
          nay --model gemini/gemini-2.0-pro-exp \
              --system @prompt.md \
              --non-interactive \
              --input "run"

      - name: Upload HTML report + screenshots + CSV
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: e2e-report-and-screenshots
          path: |
            playwright-report/
            screenshots/
            *.csv
            test-results.*